var ft=Object.create;var Te=Object.defineProperty;var ht=Object.getOwnPropertyDescriptor;var pt=Object.getOwnPropertyNames;var gt=Object.getPrototypeOf,mt=Object.prototype.hasOwnProperty;var $e=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var vt=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of pt(t))!mt.call(e,r)&&r!==n&&Te(e,r,{get:()=>t[r],enumerable:!(i=ht(t,r))||i.enumerable});return e};var _=(e,t,n)=>(n=e!=null?ft(gt(e)):{},vt(t||!e||!e.__esModule?Te(n,"default",{value:e,enumerable:!0}):n,e));var Z=$e((Cn,Re)=>{"use strict";Re.exports=St;function W(e){return e instanceof Buffer?Buffer.from(e):new e.constructor(e.buffer.slice(),e.byteOffset,e.length)}function St(e){if(e=e||{},e.circles)return bt(e);return e.proto?i:n;function t(r,s){for(var a=Object.keys(r),o=new Array(a.length),u=0;u<a.length;u++){var l=a[u],d=r[l];typeof d!="object"||d===null?o[l]=d:d instanceof Date?o[l]=new Date(d):ArrayBuffer.isView(d)?o[l]=W(d):o[l]=s(d)}return o}function n(r){if(typeof r!="object"||r===null)return r;if(r instanceof Date)return new Date(r);if(Array.isArray(r))return t(r,n);if(r instanceof Map)return new Map(t(Array.from(r),n));if(r instanceof Set)return new Set(t(Array.from(r),n));var s={};for(var a in r)if(Object.hasOwnProperty.call(r,a)!==!1){var o=r[a];typeof o!="object"||o===null?s[a]=o:o instanceof Date?s[a]=new Date(o):o instanceof Map?s[a]=new Map(t(Array.from(o),n)):o instanceof Set?s[a]=new Set(t(Array.from(o),n)):ArrayBuffer.isView(o)?s[a]=W(o):s[a]=n(o)}return s}function i(r){if(typeof r!="object"||r===null)return r;if(r instanceof Date)return new Date(r);if(Array.isArray(r))return t(r,i);if(r instanceof Map)return new Map(t(Array.from(r),i));if(r instanceof Set)return new Set(t(Array.from(r),i));var s={};for(var a in r){var o=r[a];typeof o!="object"||o===null?s[a]=o:o instanceof Date?s[a]=new Date(o):o instanceof Map?s[a]=new Map(t(Array.from(o),i)):o instanceof Set?s[a]=new Set(t(Array.from(o),i)):ArrayBuffer.isView(o)?s[a]=W(o):s[a]=i(o)}return s}}function bt(e){var t=[],n=[];return e.proto?s:r;function i(a,o){for(var u=Object.keys(a),l=new Array(u.length),d=0;d<u.length;d++){var h=u[d],f=a[h];if(typeof f!="object"||f===null)l[h]=f;else if(f instanceof Date)l[h]=new Date(f);else if(ArrayBuffer.isView(f))l[h]=W(f);else{var p=t.indexOf(f);p!==-1?l[h]=n[p]:l[h]=o(f)}}return l}function r(a){if(typeof a!="object"||a===null)return a;if(a instanceof Date)return new Date(a);if(Array.isArray(a))return i(a,r);if(a instanceof Map)return new Map(i(Array.from(a),r));if(a instanceof Set)return new Set(i(Array.from(a),r));var o={};t.push(a),n.push(o);for(var u in a)if(Object.hasOwnProperty.call(a,u)!==!1){var l=a[u];if(typeof l!="object"||l===null)o[u]=l;else if(l instanceof Date)o[u]=new Date(l);else if(l instanceof Map)o[u]=new Map(i(Array.from(l),r));else if(l instanceof Set)o[u]=new Set(i(Array.from(l),r));else if(ArrayBuffer.isView(l))o[u]=W(l);else{var d=t.indexOf(l);d!==-1?o[u]=n[d]:o[u]=r(l)}}return t.pop(),n.pop(),o}function s(a){if(typeof a!="object"||a===null)return a;if(a instanceof Date)return new Date(a);if(Array.isArray(a))return i(a,s);if(a instanceof Map)return new Map(i(Array.from(a),s));if(a instanceof Set)return new Set(i(Array.from(a),s));var o={};t.push(a),n.push(o);for(var u in a){var l=a[u];if(typeof l!="object"||l===null)o[u]=l;else if(l instanceof Date)o[u]=new Date(l);else if(l instanceof Map)o[u]=new Map(i(Array.from(l),s));else if(l instanceof Set)o[u]=new Set(i(Array.from(l),s));else if(ArrayBuffer.isView(l))o[u]=W(l);else{var d=t.indexOf(l);d!==-1?o[u]=n[d]:o[u]=s(l)}}return t.pop(),n.pop(),o}}});var Ae=$e(Ce=>{"use strict";Ce.parse=Yt;Ce.serialize=Zt;var Xt=Object.prototype.toString,he=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function Yt(e,t){if(typeof e!="string")throw new TypeError("argument str must be a string");for(var n={},i=t||{},r=i.decode||en,s=0;s<e.length;){var a=e.indexOf("=",s);if(a===-1)break;var o=e.indexOf(";",s);if(o===-1)o=e.length;else if(o<a){s=e.lastIndexOf(";",a-1)+1;continue}var u=e.slice(s,a).trim();if(n[u]===void 0){var l=e.slice(a+1,o).trim();l.charCodeAt(0)===34&&(l=l.slice(1,-1)),n[u]=rn(l,r)}s=o+1}return n}function Zt(e,t,n){var i=n||{},r=i.encode||tn;if(typeof r!="function")throw new TypeError("option encode is invalid");if(!he.test(e))throw new TypeError("argument name is invalid");var s=r(t);if(s&&!he.test(s))throw new TypeError("argument val is invalid");var a=e+"="+s;if(i.maxAge!=null){var o=i.maxAge-0;if(isNaN(o)||!isFinite(o))throw new TypeError("option maxAge is invalid");a+="; Max-Age="+Math.floor(o)}if(i.domain){if(!he.test(i.domain))throw new TypeError("option domain is invalid");a+="; Domain="+i.domain}if(i.path){if(!he.test(i.path))throw new TypeError("option path is invalid");a+="; Path="+i.path}if(i.expires){var u=i.expires;if(!nn(u)||isNaN(u.valueOf()))throw new TypeError("option expires is invalid");a+="; Expires="+u.toUTCString()}if(i.httpOnly&&(a+="; HttpOnly"),i.secure&&(a+="; Secure"),i.priority){var l=typeof i.priority=="string"?i.priority.toLowerCase():i.priority;switch(l){case"low":a+="; Priority=Low";break;case"medium":a+="; Priority=Medium";break;case"high":a+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(i.sameSite){var d=typeof i.sameSite=="string"?i.sameSite.toLowerCase():i.sameSite;switch(d){case!0:a+="; SameSite=Strict";break;case"lax":a+="; SameSite=Lax";break;case"strict":a+="; SameSite=Strict";break;case"none":a+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return a}function en(e){return e.indexOf("%")!==-1?decodeURIComponent(e):e}function tn(e){return encodeURIComponent(e)}function nn(e){return Xt.call(e)==="[object Date]"||e instanceof Date}function rn(e,t){try{return t(e)}catch(n){return e}}});var Ne=Object.prototype.hasOwnProperty;function x(e,t){var n,i;if(e===t)return!0;if(e&&t&&(n=e.constructor)===t.constructor){if(n===Date)return e.getTime()===t.getTime();if(n===RegExp)return e.toString()===t.toString();if(n===Array){if((i=e.length)===t.length)for(;i--&&x(e[i],t[i]););return i===-1}if(!n||typeof e=="object"){i=0;for(n in e)if(Ne.call(e,n)&&++i&&!Ne.call(t,n)||!(n in t)||!x(e[n],t[n]))return!1;return Object.keys(t).length===i}}return e!==e&&t!==t}function F(e){return{all:e=e||new Map,on:function(t,n){var i=e.get(t);i?i.push(n):e.set(t,[n])},off:function(t,n){var i=e.get(t);i&&(n?i.splice(i.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var i=e.get(t);i&&i.slice().map(function(r){r(n)}),(i=e.get("*"))&&i.slice().map(function(r){r(t,n)})}}}function X(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)e[i]=n[i]}return e}var yt={read:function(e){return e[0]==='"'&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function pe(e,t){function n(r,s,a){if(typeof document!="undefined"){a=X({},t,a),typeof a.expires=="number"&&(a.expires=new Date(Date.now()+a.expires*864e5)),a.expires&&(a.expires=a.expires.toUTCString()),r=encodeURIComponent(r).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var o="";for(var u in a)!a[u]||(o+="; "+u,a[u]!==!0&&(o+="="+a[u].split(";")[0]));return document.cookie=r+"="+e.write(s,r)+o}}function i(r){if(!(typeof document=="undefined"||arguments.length&&!r)){for(var s=document.cookie?document.cookie.split("; "):[],a={},o=0;o<s.length;o++){var u=s[o].split("="),l=u.slice(1).join("=");try{var d=decodeURIComponent(u[0]);if(a[d]=e.read(l,d),r===d)break}catch(h){}}return r?a[r]:a}}return Object.create({set:n,get:i,remove:function(r,s){n(r,"",X({},s,{expires:-1}))},withAttributes:function(r){return pe(this.converter,X({},this.attributes,r))},withConverter:function(r){return pe(X({},this.converter,r),this.attributes)}},{attributes:{value:Object.freeze(t)},converter:{value:Object.freeze(e)}})}var wt=pe(yt,{path:"/"}),Y=wt;var tt=_(Z(),1);var rt=_(Z(),1),st=_(Z(),1),Dt=Object.defineProperty,xt=(e,t,n)=>t in e?Dt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,R=(e,t,n)=>(xt(e,typeof t!="symbol"?t+"":t,n),n),Ee=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)},c=(e,t,n)=>(Ee(e,t,"read from private field"),n?n.call(e):t.get(e)),g=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},y=(e,t,n,i)=>(Ee(e,t,"write to private field"),i?i.call(e,n):t.set(e,n),n),D=(e,t,n)=>(Ee(e,t,"access private method"),n);function kt(e,t){let n={...e};for(let i in t){let r=We(e,i,t,new Set([i]));r!==0&&(n[i]=r)}return n}function We(e,t,n,i){var r;let s=0;for(let a of n[t].inputs){let o=(r=e[a.dim])!=null?r:0;if(!o&&n[a.dim]){if(i.has(a.dim))continue;let u=new Set(i);u.add(a.dim),o=We(e,a.dim,n,u)}if(o!==0)if(a.sign==="c"){s=0;break}else a.sign==="-"?s-=o:s+=o}return s}var qe="_",ee,te,Et=class{constructor(e,t,n){g(this,ee,void 0),g(this,te,void 0),R(this,"signal"),this.signal=e,y(this,ee,t),y(this,te,n)}computeSignal(e,t){if(e.scores[this.signal.id]>=this.signal.cap&&this.signal.dur!=="t")return;let n=c(this,ee).evaluate(e,this.signal.crit,t,this.signal,c(this,te)),i=this.signal.dur==="s"||this.signal.dur==="t"?"modscoreS":"modscore";if(n.changed){if(n.result)t.push({type:i,data:{dimension:this.signal.id,delta:this.signal.str}});else if(this.signal.dur==="t"){let r=e.visitor.sessionScores[this.signal.id];r&&t.push({type:i,data:{dimension:this.signal.id,delta:-r}})}}}};ee=new WeakMap,te=new WeakMap;var O,ne,j,Mt=class{constructor({manifest:e,evaluator:t=new Qe({}),onLogMessage:n=()=>{}}){R(this,"data"),g(this,O,void 0),g(this,ne,void 0),g(this,j,void 0);var i,r,s;y(this,O,(i=e.project)!=null?i:{}),this.data=e,y(this,ne,Object.entries((s=(r=c(this,O).pz)==null?void 0:r.sig)!=null?s:[]).map(([a,o])=>new Et({...o,id:a},t,n))),y(this,j,n)}rollForControlGroup(){var e,t;return Math.random()<((t=(e=c(this,O).pz)==null?void 0:e.control)!=null?t:0)}getTest(e){var t;return(t=c(this,O).test)==null?void 0:t[e]}computeSignals(e){let t=[];c(this,j).call(this,["debug",200,"GROUP"]);try{c(this,ne).forEach(n=>{c(this,j).call(this,["debug",201,"GROUP",n.signal]);try{n.computeSignal(e,t)}finally{c(this,j).call(this,["debug",201,"ENDGROUP"])}})}finally{c(this,j).call(this,["debug",200,"ENDGROUP"])}return t}computeAggregateDimensions(e){var t,n;return kt(e,(n=(t=c(this,O).pz)==null?void 0:t.agg)!=null?n:{})}getDimensionByKey(e){var t,n,i,r;let s=e.indexOf(qe);return s<=0?(n=(t=c(this,O).pz)==null?void 0:t.sig)==null?void 0:n[e]:(r=(i=c(this,O).pz)==null?void 0:i.enr)==null?void 0:r[e.substring(0,s)]}};O=new WeakMap,ne=new WeakMap,j=new WeakMap;function J(e,t){var n,i,r,s,a,o;let u=(n=t==null?void 0:t.op)!=null?n:"=";if(t.op==="*")return e!==null&&typeof e!="undefined";if(t.op==="!*")return e===null||typeof e=="undefined";if(!("rhs"in t))throw new Error(`Match expression is required for match type ${u}`);let l=(i=t.cs)!=null?i:!1,d=(l?e!=null?e:"":Le(e)).toString(),h=(l?t.rhs:Le(t.rhs)).toString();switch(u){case"=":return d===h;case"!=":return d!==h;case"~":return(r=d.includes(h))!=null?r:!1;case"!~":return!((s=d.includes(h))==null||s);case"//":return new RegExp(t.rhs.toString(),l?"":"i").test((a=e==null?void 0:e.toString())!=null?a:"");case"!//":return!new RegExp(t.rhs.toString(),l?"":"i").test((o=e==null?void 0:e.toString())!=null?o:"");default:throw new Error(`Unknown match type ${u}.`)}}function fe(e,t){return`'${"cs"in t&&t.cs?e:e==null?void 0:e.toString().toUpperCase()}' ${ze(t)}`}function ze(e){return"rhs"in e?`${e.op} '${e.cs?e.rhs:e.rhs.toString().toUpperCase()}'`:`${e.op==="*"?"exists":"does not exist"}`}function Le(e){var t,n;return(n=(t=e==null?void 0:e.toString())==null?void 0:t.toUpperCase())!=null?n:""}var Ct=({update:e,criteria:t,onLogMessage:n})=>{var i,r;if(t.type!=="CK")return{result:!1,changed:!1};let s=!x(je(e.state.cookies),je((i=e.previousState)==null?void 0:i.cookies)),a=(r=e.state.cookies)==null?void 0:r[t.cookieName],o={result:J(a,t.match),changed:s};return n==null||n(["debug",203,{criteria:t,result:o,explanation:fe(a,t.match)}]),o};function je(e){if(!e)return;if(!e.ufvd)return e;let{ufvd:t,...n}=e;return n}function At(e,t){var n;if(typeof e=="undefined"||e===null)return!1;let i=Number(e);if(isNaN(i))return!1;switch((n=t==null?void 0:t.op)!=null?n:"="){case"=":return i===t.rhs;case"!=":return i!==t.rhs;case">":return i>t.rhs;case"<":return i<t.rhs;default:return console.warn(`Unknown match type ${t.op} is false.`),!1}}function Ot(e,t){return`${e} ${Ut(t)}`}function Ut(e){return`${e.op} ${e.rhs}`}function Be(e,t){return`${e}${qe}${t}`}var ge=Be("$pvc","v"),_e=({update:e,criteria:t,commands:n,onLogMessage:i})=>{var r,s;if(t.type!=="PVC")return{result:!1,changed:!1};let a=Boolean(e.state.url&&(!e.previousState||((r=e.state.url)==null?void 0:r.toString())!==((s=e.previousState.url)==null?void 0:s.toString()))),o=(e.visitor.sessionScores[ge]||0)+1,u={result:!1,changed:a},l=n.some(d=>d.type==="modscoreS"&&d.data.dimension===ge);return a&&!l&&n.push({type:"modscoreS",data:{dimension:ge,delta:1}}),At(o,t.match)&&(u.result=!0),i==null||i(["debug",203,{criteria:t,result:u,explanation:Ot(o,t.match)}]),u};_e.alwaysExecute=!0;var Tt=({update:e,criteria:t,onLogMessage:n})=>{var i,r,s,a,o;if(t.type!=="QS")return{result:!1,changed:!1};let u=!e.previousState||((r=(i=e.state.url)==null?void 0:i.searchParams)==null?void 0:r.toString())!==((a=(s=e.previousState.url)==null?void 0:s.searchParams)==null?void 0:a.toString()),l=(o=e.state.url)==null?void 0:o.searchParams.get(t.queryName),d={result:J(l,t.match),changed:u};return n==null||n(["debug",203,{criteria:t,result:d,explanation:fe(l,t.match)}]),d},$t=({update:e,criteria:t,signal:n,onLogMessage:i})=>{var r;if(t.type!=="QK")return{result:!1,changed:!1};if(typeof document=="undefined"&&n.dur==="t"&&e.scores[n.id]>0)return{result:!0,changed:!1};let s=e.visitor.quirks[t.key],a=(r=e.state.quirks)==null?void 0:r[t.key],o=a!=null?a:s,u=Boolean(a&&s!==a),l={result:J(o,t.match),changed:u};return i==null||i(["debug",203,{criteria:t,result:l,explanation:fe(o,t.match)}]),l},Nt=({update:e,criteria:t,onLogMessage:n})=>{var i,r,s;if(t.type!=="EVT")return{result:!1,changed:!1};let a=(r=(i=e.state.events)==null?void 0:i.some(u=>J(u.event,t.event)))!=null?r:!1,o={result:a,changed:a};return n==null||n(["debug",203,{criteria:t,result:o,explanation:`'${(s=e.state.events)==null?void 0:s.join("', '")}' ${ze(t.event)}`}]),o},Rt=({update:e,criteria:t,onLogMessage:n})=>{var i,r,s;if(t.type!=="PV")return{result:!1,changed:!1};let a=(i=e.state.url)==null?void 0:i.pathname,o=!e.previousState||(a==null?void 0:a.toString())!==((s=(r=e.previousState.url)==null?void 0:r.pathname)==null?void 0:s.toString()),u={result:J(a,t.path),changed:o};return n==null||n(["debug",203,{criteria:t,result:u,explanation:fe(a,t.path)}]),u},ie,Qe=class{constructor(e){g(this,ie,void 0),y(this,ie,e)}evaluate(e,t,n,i,r){let s=t.clauses.length>1;s&&(r==null||r(["debug",202,"GROUP",t]));try{let a=!(t.op==="&"||!t.op),o=null,u=!1;for(let d of t.clauses){let h;if(d.type==="G")h=this.evaluate(e,d,n,i,r);else{let f=c(this,ie)[d.type];if(o&&!f.alwaysExecute)continue;if(!f)throw new Error(`${d.type} signal criteria not registered`);h=f({update:e,criteria:d,commands:n,signal:i,onLogMessage:r})}h.changed&&(u=!0),!o&&h.result===a&&(o={result:a,changed:u})}let l=o!=null?o:{result:!a,changed:u};return s&&(r==null||r(["debug",204,l])),l}finally{s&&(r==null||r(["debug",202,"ENDGROUP"]))}}};ie=new WeakMap;var Ke=()=>({quirks:{},scores:{},sessionScores:{},tests:{},consent:!1,controlGroup:!1}),Lt="__UNIFORM_DATA__",I,re,Q,jt=class{constructor({initialData:e}){g(this,I,void 0),g(this,re,void 0),g(this,Q,F()),R(this,"events",{on:c(this,Q).on,off:c(this,Q).off}),e&&(y(this,I,e),y(this,re,e))}get data(){return c(this,I)}get initialData(){return c(this,re)}updateData(e,t){return y(this,I,t),this.handleUpdateData(e,t)}async delete(e){y(this,I,void 0),await this.handleDelete(e)}signalAsyncDataUpdate(e){x(this.data,e)||(y(this,I,e),c(this,Q).emit("dataUpdatedAsync",e))}getClientTransitionState(){if(typeof document=="undefined")return;let e=document.getElementById(Lt);return e!=null&&e.textContent?JSON.parse(e.textContent):void 0}};I=new WeakMap,re=new WeakMap,Q=new WeakMap;var Se="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ie=Se.split(""),He=new Array(123);for(let e=0;e<Se.length;e++)He[Se.charCodeAt(e)]=e;var Je=e=>{if(e<0)return`-${Je(-e)}`;let t=e>>>0,n=e/4294967296>>>0,i="";for(;n>0;)i=Ie[63&t]+i,t>>>=6,t|=(63&n)<<26,n>>>=6;let r="";do r=Ie[63&t]+r,t>>>=6;while(t>0);return r+i},It=e=>{let t=0,n=e.charAt(0)==="-"?1:0;for(let i=n;i<e.length;i++)t=t*64+He[e.charCodeAt(i)];return n?-t:t},me=typeof document=="undefined",Me="ufvd",z,se,Xe=class extends jt{constructor({serverCookieValue:e,cookieName:t=Me,cookieAttributes:n={sameSite:"lax"}}){super({initialData:me?Pt(e):void 0}),g(this,z,void 0),g(this,se,void 0),y(this,z,t),y(this,se,n)}handleDelete(){return me||Y.remove(c(this,z)),Promise.resolve()}async handleUpdateData(e,t){me||(t.consent?Y.set(c(this,z),Gt(t),c(this,se)):Y.remove(c(this,z)))}};z=new WeakMap,se=new WeakMap;var Ye="~",Ze="!",et="-";function Pt(e){if(!e)return;let t=e.split(Ye);if(t.length>3)return;let[n,i,r]=t;return{consent:!0,sessionScores:Pe(ve(i)),scores:Pe(ve(r)),tests:ve(n)}}function ve(e){return e.split(Ze).map(t=>t.split(et)).reduce((t,n)=>(n.length<2||(t[n[0]]=n.slice(1).join("-")),t),{})}function Pe(e){return Object.entries(e).reduce((t,[n,i])=>(t[n]=It(i),t),{})}function Gt(e){return[ye(e.tests),ye(Ge(e.sessionScores)),ye(Ge(e.scores))].join(Ye)}function Ge(e){return Object.entries(e).reduce((t,[n,i])=>(t[n]=Je(i),t),{})}function ye(e){return Object.entries(e).map(t=>t.join(et)).join(Ze)}var Vt,Ft;Vt=new WeakSet,Ft=async function(){let e=await new Promise(t=>{setTimeout(()=>{t(void 0)},2e3)});e&&this.signalAsyncDataUpdate(e)};var Wt=class{constructor(){R(this,"inMemoryFallback",{}),R(this,"hasLocalStorageObject",typeof localStorage!="undefined")}get(e){let t=this.inMemoryFallback[e];if(!this.hasLocalStorageObject||t)return t;try{let n=localStorage.getItem(e);return n?JSON.parse(n):void 0}catch(n){return t}}set(e,t,n){if(this.inMemoryFallback[e]=t,!(!this.hasLocalStorageObject||!n))try{localStorage.setItem(e,JSON.stringify(t))}catch(i){console.warn(i)}}delete(e,t){t||delete this.inMemoryFallback[e];try{localStorage.removeItem(e)}catch(n){}}},qt=(0,tt.default)();function zt(e,t,n){let i=t?qt(t):Ke();return e.forEach(r=>{var s,a;switch(r.type){case"consent":i.consent=r.data;break;case"setquirk":i.quirks[r.data.key]=r.data.value;break;case"settest":i.tests[r.data.test]=r.data.variant;break;case"modscore":if(n)break;let o=Number(r.data.delta);if(isNaN(o))throw new Error("Non-number delta received");let u=(s=i.scores[r.data.dimension])!=null?s:0;i.scores[r.data.dimension]=u+o;break;case"modscoreS":if(n)break;let l=Number(r.data.delta);if(isNaN(l))throw new Error("Non-number delta received");let d=(a=i.sessionScores[r.data.dimension])!=null?a:0;i.sessionScores[r.data.dimension]=d+l;break;case"identify":break;case"setcontrol":i.controlGroup=r.data;break;default:throw new Error("Unknown command")}}),i}var de="ufvisitor",$,B,K,v,C,T,L,P,be,Ve,De,nt,ae,we,oe,xe,Bt=class{constructor(e){if(g(this,C),g(this,L),g(this,be),g(this,De),g(this,ae),g(this,oe),g(this,$,F()),g(this,B,new Wt),g(this,K,void 0),g(this,v,void 0),R(this,"events",{on:c(this,$).on,off:c(this,$).off}),y(this,v,e),c(this,C,T)||D(this,L,P).call(this,D(this,oe,xe).call(this),!0),e.transitionStore){let t=e.transitionStore.getClientTransitionState();t&&e.onServerTransitionReceived&&e.onServerTransitionReceived(t),e.transitionStore.events.on("dataUpdatedAsync",i=>{D(this,L,P).call(this,{...c(this,C,T).visitorData,...i})});let n=e.transitionStore.data;n&&D(this,L,P).call(this,{...c(this,C,T).visitorData,...n},!0)}}get data(){var e,t;let n=c(this,C,T);if(D(this,De,nt).call(this,n)){let{sessionScores:i,...r}=n.visitorData;return D(this,L,P).call(this,{...r,sessionScores:{}}),(t=(e=c(this,v)).onLogMessage)==null||t.call(e,["info",120]),c(this,C,T).visitorData}return n.visitorData}get decayEnabled(){return!!c(this,v).decay}get options(){return c(this,v)}async updateData(e){var t,n,i,r;if(e.length===0)return;(n=(t=c(this,v)).onLogMessage)==null||n.call(t,["debug",101,e]);let s=zt(e,this.data,(i=c(this,C,T))==null?void 0:i.visitorData.controlGroup);e.some(a=>a.type==="consent"&&!a.data)&&c(this,B).delete(de,!0),D(this,L,P).call(this,s),await((r=c(this,v).transitionStore)==null?void 0:r.updateData(e,c(this,C,T).visitorData))}async delete(e){var t,n,i,r,s;(n=(t=c(this,v)).onLogMessage)==null||n.call(t,["info",103,"GROUP",e]);try{c(this,B).delete(de,!1),await((i=c(this,v).transitionStore)==null?void 0:i.delete(e)),D(this,L,P).call(this,D(this,oe,xe).call(this))}finally{(s=(r=c(this,v)).onLogMessage)==null||s.call(r,["info",103,"ENDGROUP"])}}};$=new WeakMap,B=new WeakMap,K=new WeakMap,v=new WeakMap,C=new WeakSet,T=function(){return c(this,B).get(de)},L=new WeakSet,P=function(e,t=!1){var n,i,r,s,a,o,u,l,d;let h=c(this,C,T),f=Date.now();e.controlGroup?(e.scores={},e.sessionScores={}):(D(this,ae,we).call(this,e.scores),D(this,ae,we).call(this,e.sessionScores),(i=(n=c(this,v)).decay)==null||i.call(n,{now:f,lastUpd:h==null?void 0:h.updated,scores:e.scores,sessionScores:e.sessionScores,onLogMessage:c(this,v).onLogMessage}));let p=!x(h==null?void 0:h.visitorData.scores,e.scores),S=!x(h==null?void 0:h.visitorData.sessionScores,e.sessionScores),M=!x(h==null?void 0:h.visitorData.quirks,e.quirks),b=!x(h==null?void 0:h.visitorData.tests,e.tests),G={updated:f,visitorData:e};D(this,be,Ve).call(this),c(this,B).set(de,G,!!e.consent),(s=(r=c(this,v)).onLogMessage)==null||s.call(r,["debug",102,e]),t||((p||S)&&c(this,$).emit("scoresUpdated",e),M&&c(this,$).emit("quirksUpdated",e),b&&c(this,$).emit("testsUpdated",e),((a=h==null?void 0:h.visitorData)==null?void 0:a.consent)!==e.consent&&c(this,$).emit("consentUpdated",e),((o=h==null?void 0:h.visitorData)==null?void 0:o.controlGroup)!==e.controlGroup&&(c(this,$).emit("controlGroupUpdated",e),(d=(l=c(this,v)).onLogMessage)==null||d.call(l,["debug",104,(u=e.controlGroup)!=null?u:!1])))},be=new WeakSet,Ve=function(){typeof document=="undefined"||!c(this,v).visitLifespan||(c(this,K)&&window.clearTimeout(c(this,K)),y(this,K,window.setTimeout(()=>{this.data},c(this,v).visitLifespan+50)))},De=new WeakSet,nt=function(e){let t=c(this,v).visitLifespan;return t?e.updated+t<Date.now():!1},ae=new WeakSet,we=function(e){var t,n;if(c(this,v).manifest)for(let i in e){let r=e[i],s=c(this,v).manifest.getDimensionByKey(i);!s||r>s.cap&&((n=(t=c(this,v)).onLogMessage)==null||n.call(t,["debug",110,{dim:i,score:r,cap:s.cap}]),e[i]=s.cap)}},oe=new WeakSet,xe=function(){var e,t,n;return{...Ke(),consent:(e=c(this,v).defaultConsent)!=null?e:!1,controlGroup:(n=(t=c(this,v).manifest)==null?void 0:t.rollForControlGroup())!=null?n:!1}};function _t({name:e,context:t,variations:n,take:i=1,onLogMessage:r}){var s,a,o;r==null||r(["info",300,"GROUP",{name:e,take:i}]);try{let u=(s=t.storage.data.controlGroup)!=null?s:!1,l=[],d=!1,h=t.scores;for(let f of n){if(l.length===i)break;if(!((a=f.pz)!=null&&a.crit.length)){r==null||r(["info",301,"GROUP",{id:f.id,op:(o=f.pz)==null?void 0:o.op}]),r==null||r(["info",302,{matched:!0,description:"default variation"}]),r==null||r(["info",303,!0]),r==null||r(["info",301,"ENDGROUP"]),l.push(f);continue}u||Qt(f.id,f.pz,h,r)&&(d=!0,l.push(f))}return{personalized:d,variations:l}}finally{r==null||r(["info",300,"ENDGROUP"])}}function Qt(e,t,n,i){i==null||i(["info",301,"GROUP",{id:e,op:t==null?void 0:t.op}]);let r;try{t!=null&&t.crit?!t.op||t.op==="&"?r=t.crit.every(s=>Fe(s,n,i)):r=t.crit.some(s=>Fe(s,n,i)):(i==null||i(["info",302,{matched:!0,description:"default variation"}]),r=!0),i==null||i(["info",303,r])}finally{i==null||i(["info",301,"ENDGROUP"])}return r}function Fe(e,t,n){var i,r;let{op:s,l:a}=e,o=(i=t[a])!=null?i:0;if(s==="+"){let l=Math.max(...Object.values(t))===o&&o>0;return n==null||n(["info",302,{matched:l,description:`${e.l} has the highest score`}]),l}else if(s==="-"){let l=Math.min(...Object.values(t))===o&&o>0;return n==null||n(["info",302,{matched:l,description:`${e.l} has the lowest non-zero score`}]),l}let u;if(e.rDim?u=t[e.rDim]||0:u=parseInt(e.r,10),isNaN(u))return n==null||n(["info",302,{matched:!1,description:`${(r=e.rDim)!=null?r:e.r} has no score value`}]),!1;if(s===">"){let l=o>u;return q(n,l,e,o,u),l}else if(s===">="){let l=o>=u;return q(n,l,e,o,u),l}else if(s==="<"){let l=o<u;return q(n,l,e,o,u),l}else if(s==="<="){let l=o<=u;return q(n,l,e,o,u),l}else if(s==="="){let l=o===u;return q(n,l,e,o,u),l}else if(s==="!="){let l=o!==u;return q(n,l,e,o,u),l}else throw new Error(`Unknown op: ${s}`)}function q(e,t,n,i,r){e==null||e(["info",302,{matched:t,description:`${n.l}[${i}] ${n.op} ${n.rDim?`${n.rDim}[${r}]`:n.r}`}])}var Kt=e=>{let{values:t,total:n,missingDistribution:i}=e.reduce((r,s)=>(s.testDistribution?r.total+=s.testDistribution:++r.missingDistribution,r.values.push(s.testDistribution),r),{values:[],total:0,missingDistribution:0});if(n>100)throw new Error(`Total distribution ${n} is over the maximum 100.`);if(n<100){let r=(100-n)/i;t.forEach((s,a)=>{typeof s=="undefined"&&(t[a]=r)})}return t},Ht=({name:e,context:t,variations:n,onLogMessage:i})=>{i==null||i(["info",400,"GROUP",e]);try{let r,s=t.getTestVariantId(e);if(s===null)return i==null||i(["error",401,e]),{result:void 0,variantAssigned:!1};if(s&&(r=n.find(a=>a.id===s),r||i==null||i(["warn",402,{missingVariant:s,variants:n.map(a=>a.id)}])),!r){let a=Kt(n),o=Math.floor(Math.random()*100),u=0;r=n.find((l,d)=>{let h=a[d];if(o>u&&o<=u+h)return l;u+=h}),r&&(i==null||i(["info",403,r.id]),t.setTestVariantId(e,r.id))}return r&&(i==null||i(["info",404,r.id])),{result:r,variantAssigned:!s}}finally{i==null||i(["info",400,"ENDGROUP"])}},k,N,U,le,m,ue,ke,H,ce,it=class{constructor(e){g(this,ue),g(this,H),R(this,"manifest"),g(this,k,void 0),g(this,N,{}),g(this,U,void 0),g(this,le,{}),g(this,m,F()),R(this,"events",{on:c(this,m).on,off:c(this,m).off}),R(this,"storage");var t,n;let{manifest:i,...r}=e;y(this,U,{}),(t=e.plugins)==null||t.forEach(s=>{!s.logDrain||c(this,m).on("log",s.logDrain)}),c(this,m).emit("log",["info",1,"GROUP"]);try{this.manifest=new Mt({onLogMessage:s=>c(this,m).emit("log",s),manifest:i,evaluator:new Qe({CK:Ct,QS:Tt,QK:$t,PVC:_e,EVT:Nt,PV:Rt})}),this.storage=new Bt({...r,manifest:this.manifest,onServerTransitionReceived:s=>{y(this,k,s),s.ssv&&(y(this,N,s.ssv),c(this,m).emit("log",["debug",130,s]))},onLogMessage:s=>c(this,m).emit("log",s)}),this.storage.events.on("scoresUpdated",D(this,H,ce).bind(this)),c(this,k)||D(this,H,ce).call(this,this.storage.data),this.storage.events.on("quirksUpdated",s=>{let a=this.manifest.computeSignals({scores:c(this,N),state:c(this,U),previousState:c(this,U),visitor:this.storage.data});this.storage.updateData(a),c(this,m).emit("quirksUpdated",s.quirks),c(this,m).emit("log",["info",4,s.quirks])}),(n=e.plugins)==null||n.forEach(s=>{!s.init||s.init(this)})}finally{c(this,m).emit("log",["info",1,"ENDGROUP"])}}get scores(){return c(this,N)}get quirks(){var e,t;return(t=(e=c(this,k))==null?void 0:e.quirks)!=null?t:this.storage.data.quirks}async update(e){var t,n,i;let r=[],s={};if((t=c(this,k))!=null&&t.quirks&&(e={...e,quirks:{...c(this,k).quirks,...e.quirks||{}}}),(n=c(this,k))!=null&&n.tests){let a=Object.entries(c(this,k).tests);if(a.length>0){let o=[];a.forEach(([u,l])=>{this.storage.data.tests[u]||(o.push([u,l]),s[u]=l)}),r.push(...o.map(([u,l])=>({type:"settest",data:{test:u,variant:l}})))}}try{c(this,m).emit("log",["info",2,"GROUP",{...e,url:(i=e.url)==null?void 0:i.toString()}]),e.quirks&&r.push(...Object.entries(e.quirks).map(([a,o])=>({type:"setquirk",data:{key:a,value:o}}))),e.enrichments&&e.enrichments.forEach(a=>{let o=Be(a.cat,a.key);this.manifest.getDimensionByKey(o)?r.push({type:"modscore",data:{dimension:o,delta:a.str}}):c(this,m).emit("log",["warn",5,a])}),r.push(...this.manifest.computeSignals({state:e,previousState:c(this,U),visitor:this.storage.data,scores:c(this,N)})),y(this,U,{...c(this,U),...e}),await this.storage.updateData(r),c(this,k)&&(D(this,H,ce).call(this,this.storage.data),Object.entries(s).forEach(([a,o])=>{D(this,ue,ke).call(this,{name:a,variantId:o,variantAssigned:!0})}),y(this,k,void 0),c(this,m).emit("log",["debug",131]))}finally{c(this,m).emit("log",["info",2,"ENDGROUP"])}}getTestVariantId(e){var t,n,i,r;let s=this.manifest.getTest(e);return s?(r=(i=s.wv)!=null?i:(n=(t=c(this,k))==null?void 0:t.tests)==null?void 0:n[e])!=null?r:this.storage.data.tests[e]:(c(this,m).emit("log",["warn",401,e]),null)}setTestVariantId(e,t){this.storage.updateData([{type:"settest",data:{test:e,variant:t}}])}log(...e){c(this,m).emit("log",e)}test(e){var t,n;let i=Ht({...e,context:this,onLogMessage:r=>c(this,m).emit("log",r)});return D(this,ue,ke).call(this,{name:e.name,variantId:(n=(t=i.result)==null?void 0:t.id)!=null?n:void 0,variantAssigned:i.variantAssigned}),i}personalize(e){let t=_t({...e,context:this,onLogMessage:r=>c(this,m).emit("log",r)}),n=c(this,le)[e.name],i={name:e.name,variantIds:t.variations.map(r=>{var s;return(s=r.id)!=null?s:"Unknown"}),control:this.storage.data.controlGroup,changed:!0};return n&&x(i.variantIds,n)&&(i.changed=!1),c(this,m).emit("personalizationResult",i),c(this,le)[e.name]=i.variantIds,t}async forget(e){y(this,U,{}),await this.storage.delete(e)}getServerToClientTransitionState(){let e={quirks:this.storage.data.quirks,ssv:c(this,N),tests:{}},t=this.storage.data.tests;return Object.entries(t).map(([n,i])=>{var r,s,a;((a=(s=(r=this.storage.options.transitionStore)==null?void 0:r.initialData)==null?void 0:s.tests)==null?void 0:a[n])!==t[n]&&e.tests&&(e.tests[n]=i)}),e}};k=new WeakMap,N=new WeakMap,U=new WeakMap,le=new WeakMap,m=new WeakMap,ue=new WeakSet,ke=function(e){c(this,m).emit("testResult",e)},H=new WeakSet,ce=function(e){var t;let n={...e.scores};for(let i in e.sessionScores)n[i]=((t=n[i])!=null?t:0)+e.sessionScores[i];n=this.manifest.computeAggregateDimensions(n),!x(n,c(this,N))&&(y(this,N,n),c(this,m).emit("scoresUpdated",n),c(this,m).emit("log",["info",3,n]))};var jn=(0,rt.default)();var In=(0,st.default)();var Jt=(e=>(e.ListStart="nesi-list-start",e.ListEnd="nesi-list-end",e.ListItem="nesi-list-item-html",e.ListItemSettings="nesi-list-item-settings",e.TestStart="nesi-test-start",e.TestEnd="nesi-test-end",e.Unknown="unknown",e))(Jt||{});var lt=_(Ae(),1),sn=91,an=93,on=44,ln=60,un={"&gt;":">","&lt;":"<"},cn={op:!0},Oe=e=>{e&&typeof e=="object"&&Object.keys(e).forEach(t=>{let n=e[t];if(cn[t]&&typeof n=="string"){let i=un[n];e[t]=i||n}else typeof n=="object"?Oe(n):Array.isArray(n)&&n.forEach(i=>{Oe(i)})})},at=(e,t)=>{let n=[sn];t.forEach((r,s)=>{s>0&&n.push(on),n.push(...r)}),n.push(an);let i=JSON.parse(e.decode(new Uint8Array(n)));return Array.isArray(i)&&i.forEach(r=>{Oe(r)}),i},dn=({list:e,decoder:t,context:n})=>{let i,r=[],s=[];for(let f=0;f<e.fragments.length;f++){let p=e.fragments[f];p.type==="list-start"?i=p:p.type==="item-settings"?r.push(p):p.type==="item-html"&&s.push({listIndex:f})}if(r.length!==s.length)throw new Error("Item settings and HTML mismatch");if(!i)throw new Error("List settings are missing");let[a,...o]=at(t,[i.content,...r.map(f=>f.content)]),u=a,l=n.personalize({...u,variations:o.map((f,p)=>{let S=s[p];return{...f,...S}})}),d=[],h=0;for(let f=0;f<e.fragments.length;f++){let p=e.fragments[f];if(p.type==="text")d.push(...p.content);else if(p.type==="item-html"){let S=l.variations[h];if(typeof S!="undefined"){let M=e.fragments[S.listIndex];if(!M)throw new Error("Invalid HTML index");d.push(...M.content)}++h}}return{bytes:d}},fn=({test:e,decoder:t,context:n})=>{let i,r=[],s=[];for(let f=0;f<e.fragments.length;f++){let p=e.fragments[f];p.type==="test-start"?i=p:p.type==="item-settings"?r.push(p):p.type==="item-html"&&s.push({listIndex:f})}if(r.length!==s.length)throw new Error("Item settings and HTML mismatch");if(!i)throw new Error("List settings are missing");let[a,...o]=at(t,[i.content,...r.map(f=>f.content)]),u=a,l=n.test({...u,name:u.name,variations:o.map((f,p)=>{let S=s[p];return{id:f.id,...S}})}),d=[],h;for(let f=0;f<e.fragments.length;f++){let p=e.fragments[f];if(p.type==="text")d.push(...p.content);else if(p.type==="item-html"&&!h&&l.result){let S=e.fragments[l.result.listIndex];if(!S)throw new Error("Invalid HTML index");d.push(...S.content),h=l.result.id}}return{bytes:d,selectedId:h,testName:u.name}},hn={[110]:!0,[47]:!0,[115]:!0},pn={[101]:!0,[110]:!0,[99]:!0,[115]:!0},gn=()=>({["list-start"]:{pattern:[60,110,101,115,105,116,97,103,32,100,97,116,97,45,116,121,112,101,61,34,110,101,115,105,45,108,105,115,116,45,115,116,97,114,116,34,62],count:0},["item-settings"]:{pattern:[60,110,101,115,105,116,97,103,32,100,97,116,97,45,116,121,112,101,61,34,110,101,115,105,45,108,105,115,116,45,105,116,101,109,45,115,101,116,116,105,110,103,115,34,62],count:0},["item-html"]:{pattern:[60,110,101,115,105,116,97,103,32,100,97,116,97,45,116,121,112,101,61,34,110,101,115,105,45,108,105,115,116,45,105,116,101,109,45,104,116,109,108,34,62],count:0},["list-end"]:{pattern:[60,110,101,115,105,116,97,103,32,100,97,116,97,45,116,121,112,101,61,34,110,101,115,105,45,108,105,115,116,45,101,110,100,34,62],count:0},["end-tag"]:{pattern:[60,47,110,101,115,105,116,97,103,62],count:0},["test-start"]:{pattern:[60,110,101,115,105,116,97,103,32,100,97,116,97,45,116,121,112,101,61,34,110,101,115,105,45,116,101,115,116,45,115,116,97,114,116,34,62],count:0},["test-end"]:{pattern:[60,110,101,115,105,116,97,103,32,100,97,116,97,45,116,121,112,101,61,34,110,101,115,105,45,116,101,115,116,45,101,110,100,34,62],count:0},["page-state"]:{pattern:[60,115,99,114,105,112,116,32,105,100,61,34,95,95,85,78,73,70,79,82,77,95,68,65,84,65,95,95,34,32,116,121,112,101,61,34,97,112,112,108,105,99,97,116,105,111,110,47,106,115,111,110,34,62],count:0},["end-script-tag"]:{pattern:[60,47,115,99,114,105,112,116,62],count:0}}),mn=({writer:e})=>{let t=!0,n=[];return{length:()=>n.length,add:i=>{!t||(typeof i=="number"?n.push(i):n.push(...i))},write:()=>{e.write(new Uint8Array(n))},disable:()=>{t=!1},enable:()=>{t=!0},get:()=>n}},vn=({value:e,state:t,stateKeys:n,patternState:i,sections:r,writeBuffer:s,encoder:a,decoder:o,context:u,pageTestState:l})=>{if(e)for(let d=0;d<e.length;d++){let h=e[d],f=!1;(t.activeSearchers||h===ln&&(d+1>=e.length||hn[e[d+1]])&&(d+2>=e.length||pn[e[d+2]]))&&n.forEach(p=>{var S,M;let b=i[p],G=b.pattern[b.count];if(h===G)b.count===0&&++t.activeSearchers,f=!0,++b.count;else if(b.count){if(--t.activeSearchers,!t.activeSearchers)for(let w=0;w<b.count;w++)t.currentFragment?t.currentFragment.content.push(b.pattern[w]):s.add(b.pattern[w]);b.count=0}if(b.count===b.pattern.length)if(--t.activeSearchers,b.count=0,f=!0,p==="end-tag"){let w=!0,E;if(((S=t.currentFragment)==null?void 0:S.type)==="list-end"){let A=r.shift(),{bytes:V}=dn({list:A,decoder:o,context:u});E=V}else if(((M=t.currentFragment)==null?void 0:M.type)==="test-end"){let A=r.shift(),{testName:V,selectedId:Ue,bytes:dt}=fn({test:A,decoder:o,context:u});Ue&&(l[V]=Ue),E=dt}if(E!=null&&E.length){let[A]=r;if(A){let V=A.fragments[A.fragments.length-1];V.content.push(...E),t.currentFragment=V,w=!1}else s.add(E)}w&&(t.currentFragment=void 0)}else if(p==="page-state"){let w=u.getServerToClientTransitionState(),E=JSON.stringify(w),A=a.encode(E);s.add(i["page-state"].pattern),s.add([].slice.call(A)),s.disable()}else if(p==="end-script-tag")s.enable(),s.add(i["end-script-tag"].pattern);else{let w={content:[],type:p};if(t.currentFragment=w,w.type==="list-start"||w.type==="test-start")r.unshift({fragments:[w]});else{let[E]=r;if(!E)throw new Error("Not in a list!");E.fragments.push(w)}}}),f||(r.length&&!t.currentFragment&&(t.currentFragment={content:[],type:"text"},r[0].fragments.push(t.currentFragment)),t.currentFragment?t.currentFragment.content.push(h):s.add(h))}},yn=({reader:e,state:t,stateKeys:n,patternState:i,sections:r,writeBuffer:s,encoder:a,decoder:o,context:u,pageTestState:l})=>new Promise(d=>{let h=()=>{e.read().then(({done:f,value:p})=>{vn({value:p,state:t,stateKeys:n,patternState:i,sections:r,writeBuffer:s,encoder:a,decoder:o,context:u,pageTestState:l}),f?d():h()})};h()}),wn=({reader:e,writer:t,encoder:n,decoder:i,context:r})=>{let s=gn(),a={},o=[],u=Object.keys(s),l=mn({writer:t});return yn({reader:e,decoder:i,encoder:n,context:r,pageTestState:a,patternState:s,sections:o,state:{activeSearchers:0,currentFragment:void 0},stateKeys:u,writeBuffer:l}).then(()=>{l.length()&&l.write()}).then(t.close)},ot=()=>async({response:e,context:t,encoder:n,decoder:i})=>{let r=e.headers.get("Content-Type");if(!((r==null?void 0:r.includes("text/html"))&&e.ok&&!!e.body))return{processed:!1,response:e};let{readable:s,writable:a}=new TransformStream,o=new Response(s,e),u=e.body.getReader(),l=a.getWriter();return wn({context:t,decoder:i,encoder:n,reader:{read:async()=>{let{done:d,value:h}=await u.read();return{done:d,value:h}}},writer:{write:d=>{l.write(d)},close:()=>l.close()}}),{processed:!0,response:o}},Sn=({manifest:e,request:t,options:n={}})=>new it({manifest:e,transitionStore:new bn({request:t}),...n}),bn=class extends Xe{constructor({request:e,...t}){var n,i;super({...t,serverCookieValue:e?(0,lt.parse)((n=e.headers.get("cookie"))!=null?n:"")[(i=t.cookieName)!=null?i:Me]:void 0})}};var ut=_(Ae()),Yn=()=>async({request:e,response:t,context:n,quirks:i})=>(await n.update({cookies:(0,ut.parse)(e.headers.get("cookie")||""),url:new URL(e.url),quirks:i}),await ot()({context:n,response:t,encoder:new TextEncoder,decoder:new TextDecoder}));var Dn=(s=>(s.CountryCode="ntl-country-code",s.CountryName="ntl-country-name",s.SubdivisionCode="ntl-subdiv-code",s.SubdivisionName="ntl-subdiv-name",s.City="ntl-city",s))(Dn||{});var ct={missingQuirkValue:"unknown",geo:{country:{code:!0},subdivision:{code:!0},city:!0}},ti=(e,t=ct)=>{var s,a,o,u,l,d,h,f,p,S,M,b,G,w;let n=t==null?void 0:t.geo;if(!n)return{};let i=(s=t.missingQuirkValue)!=null?s:ct.missingQuirkValue,r={};return(a=n.country)!=null&&a.code&&(r["ntl-country-code"]=(u=(o=e.geo.country)==null?void 0:o.code)!=null?u:i),(l=n.country)!=null&&l.name&&(r["ntl-country-name"]=(h=(d=e.geo.country)==null?void 0:d.name)!=null?h:i),(f=n.subdivision)!=null&&f.code&&(r["ntl-subdiv-code"]=(S=(p=e.geo.subdivision)==null?void 0:p.code)!=null?S:i),(M=n.subdivision)!=null&&M.name&&(r["ntl-subdiv-name"]=(G=(b=e.geo.subdivision)==null?void 0:b.name)!=null?G:i),n.city&&(r["ntl-city"]=(w=e.geo.city)!=null?w:i),r};export{Dn as NetlifyQuirks,ti as buildNetlifyQuirks,Sn as createEdgeContext,Yn as createUniformEdgeHandler};
/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */
/*! js-cookie v3.0.1 | MIT */
